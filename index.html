<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://d3js.org/d3.v3.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <title>Čobanac</title>
</head>

<body>
    <nav>
        <div class="container">
            <div class="container2">
                <img src="images/cobanac_logo.jpg" width="110">
                <h2>Čobanac</h2>
            </div>

            <div class="menu">
                <a href="index.html" class="is-active">Početna</a>
                <a href="o_cobancu.html" class="is-inactive">O čobancu</a>
            </div>
        </div>
    </nav>

    <form class="form-group-form" style="text-align: center;">
        <label for="number">Unesite broj osoba za koje želite praviti čobanac:</label>
        <input type="number" id="number" min="5" max="100" name="number" required>
    </form>

    <div class="form-group-button" style="text-align: center">
        <button onclick="prikaziSastojke()" class="button" id="toggle_sastojci">Prikaži/Sakrij sastojke</button>
    </div>

    <div class="row">
        <div class="card" id="sastojci" style="display: none;">
            <h2 id="sastojci_h2">Potrebni sastojci</h2>
            <img class="card_image" src="images/sastojci.jfif">
            <p id="sastojci_p"> 
                Unesite broj osoba za izračun potrebnih sastojaka!
            </p>
        </div>
    </div>

    <div class="form-group-button" style="text-align: center">
        <button onclick="prikaziKalorije()" class="button" id="toggle_kalorije">Prikaži/Sakrij nominalnu kalorijsku vrijednost</button>
    </div>

    <div class="row">
        <div id="kalorije" style="text-align: center; display: none;"></div>
    </div>

    <script>
        var data = 
        [{"naziv" : "Srnetina", "vrijednost" : 125},
        {"naziv" : "Junetina", "vrijednost" : 10},
        {"naziv" : "Svinjetina", "vrijednost" : 15},
        {"naziv" : "Luk", "vrijednost" : 20},
        {"naziv" : "Mrkva", "vrijednost" : 25},
        {"naziv" : "Peršin", "vrijednost" : 30},
        {"naziv" : "Celer", "vrijednost" : 50},
        {"naziv" : "Mljevena paprika", "vrijednost" : 70},
        {"naziv" : "Svinjska mast", "vrijednost" : 60},
        {"naziv" : "Pasirana rajčica", "vrijednost" : 20}
        ];

        var margin = {
            top: 40,
            bottom: 70,
            left: 70,
            right: 20
        };

        var tooltip = d3.select("#kalorije")
            .append("div")
            .style("opacity", 0)
            .attr("class", "tooltip")
            .style("background-color", "rgb(255,255,255,0.5)")
            .style("border", "solid")
            .style("border-width", "1px")
            .style("border-radius", "3px")
            .style("padding", "5px")

        var mouseover = function(d) {
            tooltip
            .style("opacity", 1)
        }

        var mousemove = function(d) {
            tooltip
            .html("Kalorijska vrijednost sastojka '" + d.naziv + "' po 100g: " + d.vrijednost + " kcal")
            .style("left", (d3.mouse(this)[0]+90) + "px")
            .style("top", (d3.mouse(this)[1]) + "px")
        }

        var mouseleave = function(d) {
            tooltip
            .transition()
            .duration(200)
            .style("opacity", 0)
        }

        var width = 500 - margin.left - margin.right;
        var height = 500 - margin.top - margin.bottom;
        var barPadding = 10;
        var barWidth = width / data.length - barPadding;

        var x = d3.scale.ordinal()    
            .domain(d3.range(data.length))
            .rangeRoundBands([0, width]);

        var y = d3.scale.linear()
            .domain([0, d3.max(data, function(d) {
                return d.vrijednost;
            })])
            .range([height, 0]);

        var svg = d3.select("#kalorije")
            .append("svg")
                .attr("width", width + margin.left + margin.right + 150)
                .attr("height", height + margin.bottom + margin.top)
                .style("background-color", "transparent")
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom")
            .tickFormat(function(d, i) {
                return "";
            });

        var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .ticks(10);

        var colors = d3.scale.ordinal()
            .domain(data - 1)
            .range(["#9C1010", "#E12C2C", "#FC6262", "#F5FC62", "#F98300",
                "#0B970A", "#74F473", "#C53103", "#FFFFD9", "#FF0000"]);

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis)
            .selectAll("text")
            .style("text-anchor", "middle");
        svg.append("text")
            .attr("x", (width / 2))
            .attr("y", -(margin.top / 2))
            .attr("font-weight", "bold")
            .style("font-size", "20px")
            .style("text-anchor", "middle")
            .text("Kalorijska vrijednost sastojka (100g)");
        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
                .attr("transform", "rotate(-90)")
                .attr("x", -(height / 2))
                .attr("y", -((margin.left / 2) + 20))
                .style("text-anchor", "middle")
                .style("font-size", "20px")
                .text("Kcal")
        svg.append("text")
            .attr("x", (width / 2))
            .attr("y", (height + (margin.bottom / 2)))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .style("font-size", "20px")
            .text("Sastojak");

        var barchart1 = svg.selectAll("rects1")
            .data(data)
            .enter()
            .append("rect")
                .attr("class", "test")
                .attr("x", function(d, i) {
                    return x(i);
                })
                .attr("y", function(d, i) {
                    return y(0);
                })
                .attr("height", function(d) {
                    return height - y(0);
                })
                .attr("width", barWidth)
                .attr("fill", function(d, i) {
                    return colors(i);
                })
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);

        var size = 15
        svg.selectAll("squares")
            .data(data)
            .enter()
            .append("rect")
                .attr("x", 420)
                .attr("y", function(d,i){ return 100 + i*(size+5)})
                .attr("width", size)
                .attr("height", size)
                .style("fill", function(d, i) {
            return colors(i);
        });

        svg.selectAll("labels")
            .data(data)
            .enter()
            .append("text")
                .attr("x", 420 + size*1.2)
                .attr("y", function(d,i){ return 100 + i*(size+5) + (size/2)})
                .style("fill", "black")
                .text(function(d){ return d.naziv})
                .attr("text-anchor", "left")
                .style("alignment-baseline", "middle");
    </script>

    <div class="form-group-button" style="text-align: center">
        <button onclick="prikaziKalorijePorcija()" class="button" id="toggle_kalorije">Prikaži/Sakrij kalorijsku vrijednost jedne porcije</button>
    </div>

    <div class="row">
        <div id="kalorije_porcija" style="text-align: center; display: none;"></div>
    </div>

    <script>
        var data_porcija = 
        [{"naziv" : "Srnetina", "vrijednost" : 59.5},
        {"naziv" : "Junetina", "vrijednost" : 53.5},
        {"naziv" : "Svinjetina", "vrijednost" : 80.5},
        {"naziv" : "Luk", "vrijednost" : 16.5},
        {"naziv" : "Mrkva", "vrijednost" : 3.5},
        {"naziv" : "Peršin", "vrijednost" : 1.85},
        {"naziv" : "Celer", "vrijednost" : 0.5},
        {"naziv" : "Mljevena paprika", "vrijednost" : 6.4},
        {"naziv" : "Svinjska mast", "vrijednost" : 4},
        {"naziv" : "Pasirana rajčica", "vrijednost" : 0.85}
        ];

        var margin = {
            top: 40,
            bottom: 70,
            left: 70,
            right: 20
        };

        var width = 500 - margin.left - margin.right;
        var height = 500 - margin.top - margin.bottom;
        var barPadding = 10;
        var barWidth = width / data_porcija.length - barPadding;

        var tooltipSecond = d3.select("#kalorije_porcija")
            .append("div")
            .style("opacity", 0)
            .attr("class", "tooltip")
            .style("background-color", "rgb(255,255,255,0.5)")
            .style("border", "solid")
            .style("border-width", "1px")
            .style("border-radius", "3px")
            .style("padding", "5px")

        var mouseover = function(d) {
            tooltipSecond
            .style("opacity", 1)
        }

        var mousemove = function(d) {
            tooltipSecond
            .html("Kalorijska vrijednost sastojka '" + d.naziv + "' po porciji: " + d.vrijednost + " kcal")
            .style("left", (d3.mouse(this)[0]+90) + "px")
            .style("top", (d3.mouse(this)[1]) + "px")
        }

        var mouseleave = function(d) {
            tooltipSecond
            .transition()
            .duration(200)
            .style("opacity", 0)
        }

        var x = d3.scale.ordinal()    
            .domain(d3.range(data_porcija.length))
            .rangeRoundBands([0, width]);

        var y = d3.scale.linear()
            .domain([0, d3.max(data_porcija, function(d) {
                return d.vrijednost;
            })])
            .range([height, 0]);

        var svg = d3.select("#kalorije_porcija")
            .append("svg")
                .attr("width", width + margin.left + margin.right + 150)
                .attr("height", height + margin.bottom + margin.top)
                .style("background-color", "transparent")
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom")
            .tickFormat(function(d, i) {
                return "";
            });

        var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .ticks(10);

        var colors = d3.scale.ordinal()
            .domain(data_porcija - 1)
            .range(["#9C1010", "#E12C2C", "#FC6262", "#F5FC62", "#F98300",
                "#0B970A", "#74F473", "#C53103", "#FFFFD9", "#FF0000"]);

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis)
            .selectAll("text")
            .style("text-anchor", "middle");
        svg.append("text")
            .attr("x", (width / 2))
            .attr("y", -(margin.top / 2))
            .attr("font-weight", "bold")
            .style("font-size", "20px")
            .style("text-anchor", "middle")
            .text("Kalorijska vrijednost jedne porcije (250ml) = 227kcal");
        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
                .attr("transform", "rotate(-90)")
                .attr("x", -(height / 2))
                .attr("y", -((margin.left / 2) + 20))
                .style("text-anchor", "middle")
                .style("font-size", "20px")
                .text("Kcal")
        svg.append("text")
            .attr("x", (width / 2))
            .attr("y", (height + (margin.bottom / 2)))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .style("font-size", "20px")
            .text("Sastojak");

        var barchart2 = svg.selectAll("rects2")
            .data(data_porcija)
            .enter()
            .append("rect")
                .attr("class", "proba")
                .attr("x", function(d, i) {
                    return x(i);
                })
                .attr("y", function(d, i) {
                    return y(0);
                })
                .attr("height", function(d) {
                    return height - y(0);
                })
                .attr("width", barWidth)
                .attr("fill", function(d, i) {
                    return colors(i);
                })
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);

        var size = 15
        svg.selectAll("squares")
            .data(data_porcija)
            .enter()
            .append("rect")
                .attr("x", 420)
                .attr("y", function(d,i){ return 100 + i*(size+5)})
                .attr("width", size)
                .attr("height", size)
                .style("fill", function(d, i) {
            return colors(i);
        });

        svg.selectAll("labels")
            .data(data_porcija)
            .enter()
            .append("text")
                .attr("x", 420 + size*1.2)
                .attr("y", function(d,i){ return 100 + i*(size+5) + (size/2)})
                .style("fill", "black")
                .text(function(d){ return d.naziv})
                .attr("text-anchor", "left")
                .style("alignment-baseline", "middle");
    </script>

    <div class="form-group-button" style="text-align: center">
        <button onclick="prikaziPostupak()" class="button" id="toggle_postupak">Prikaži/Sakrij postupak</button>
    </div>

    <div class="row">
        <div class="card" id="postupak" style="display: none;">
            <h2>Postupak</h2>
            <img class="card_image" src="images/postupak.jpeg">
            <h3>Priprema</h3>
            <p> 
                 - sitno isjeckati ili izblendati luk 
                <br> - naribati ili izblendati mrkvu, korjen peršina i korjen celera
                <br> - svo meso narezati na kockice jednake veličine
            </p>
            <h3><br>Postupak kuhanja</h3>
            <p>
                - 
            </p>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <h2>Čobanac</h2>
            <img src="images/cobanac_logo.jpg" alt="logo" width="150">
            <p>Copyright &copy; 2022 Petar Ivanković</p>
        </div>
    </footer>
</body>

<script>
    function prikaziSastojke(){
        var num = document.getElementById("number").value;
        var nog, rajcica, mast;
        var p = document.getElementById("sastojci_p");
        if(num.length != 0){
            if(num >=5 && num <=15) nog = 1, rajcica = 0.1, mast = 1;
            else if(num >= 16 && num <=30) nog = 2, rajcica = 0.2, mast = 2;
            else if(num >= 31 && num <=45) nog = 3, rajcica = 0.3, mast = 3;
            else if(num >= 46 && num <=60) nog = 4, rajcica = 0.4, mast = 4;
            else if(num >= 61 && num <=75) nog = 5, rajcica = 0.5, mast = 5;
            else if(num >= 76) nog = 6, rajcica = 0.6, mast = 6;

            var h2 = document.getElementById("sastojci_h2");
            h2.innerHTML = "Potrebni sastojci za " + num + " osoba";
            var mesokg = Number((num*250)/1000).toFixed(2);

            //p element potrebnih sastojaka
            p.innerHTML = "- " + mesokg + " kg mesa (" + Number(0.3*mesokg).toFixed(2) + " kg divljači, " + 
            Number(0.3*mesokg).toFixed(2) + " kg junetine, " + Number(0.4*mesokg).toFixed(2) + " kg svinjetine)"
            + "<br>" + "- " + Number(mesokg/3).toFixed(2) + " kg luka" + "<br>" + "- " + Number((mesokg/3)/3).toFixed(2) + " kg korjenastog povrća ("
            + Number(((mesokg/3)/3)*0.6).toFixed(2) + " kg mrkve, " + Number(((mesokg/3)/3)*0.25).toFixed(2)
            + " kg peršina, " + Number(((mesokg/3)/3)*0.15).toFixed(2) + " kg celera)" + "<br>"
            + "- " + nog + " svinjska/ih nogica" + "<br>" + "- " + Number(mesokg*3).toFixed(2) + " g papra"
            + "<br>" + "- " + Number(mesokg*20).toFixed(2) + " g soli" + "<br>" + "- " + Number(mesokg*3).toFixed(2)
            + " g ljute paprike" + "<br>" + "- " + Number(mesokg*15).toFixed(2) + " g slatke paprike"
            + "<br>" + "- " + Number(num/5).toFixed(0) + " lovorov/a list/a"
            + "<br>" + "- " + Number((num/2)+(0.25*(num/2))).toFixed(2) + " L vode (" 
            + Number(((num/2)+(0.25*(num/2)))*0.125).toFixed(2) + " L mineralne vode)"
            + "<br>" + "- " + rajcica + " L pasirane rajčice" + "<br>" + "- " + mast + " žlica/e svinjske masti";

            if(num < 5) { 
                p.innerHTML = "Broj osoba za izračun potrebnih sastojaka mora biti veći ili jednak 5!";
                h2.innerHTML = "Potrebni sastojci";
            }
        }

        var x = document.getElementById("sastojci");
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }
    function prikaziPostupak(){
        var x = document.getElementById("postupak");
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }

    function prikaziKalorije(){
        var x = document.getElementById("kalorije");
        if (x.style.display === "none") {
            x.style.display = "block";
            d3.selectAll(".test")
                .data(data)
                .transition()
                .duration(800)
                .attr("y", function(d) { return y(d.vrijednost); })
                .attr("height", function(d) { return height - y(d.vrijednost); })
                .delay(function(d,i){return(i*100)})
        } else {
            x.style.display = "none";
        }
    }

    function prikaziKalorijePorcija(){
        var x = document.getElementById("kalorije_porcija");
        if (x.style.display === "none") {
            x.style.display = "block";
            d3.selectAll(".proba")
                .data(data_porcija)
                .transition()
                .duration(800)
                .attr("y", function(d) { return y(d.vrijednost); })
                .attr("height", function(d) { return height - y(d.vrijednost); })
                .delay(function(d,i){return(i*100)})
        } else {
            x.style.display = "none";
        }
    }
</script>

</html>
